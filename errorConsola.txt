Propuesta:

El error 404 (Not Found) indica que tu aplicación React está intentando enviar los datos a una dirección que no existe.

Si te fijas en la URL del error: http://testcappecan.com/calculador-pecan/ccp/v1/projects

Le falta una parte clave de WordPress. La API REST de WordPress siempre vive bajo el prefijo /wp-json/. La URL correcta debería parecerse a: http://testcappecan.com/wp-json/ccp/v1/projects

Aquí tienes los 3 pasos para conectar React con WordPress correctamente, usando las mejores prácticas (seguridad y URLs dinámicas).

Paso 1: Pasar la URL de la API desde PHP a React
No escribas la URL "a mano" en React (hardcode), porque si cambias el dominio o mueves el sitio, se romperá. Usa wp_localize_script en tu archivo PHP principal para pasarle las variables a React.

En tu archivo PHP principal (donde haces el wp_enqueue_script), agrega esto justo después de encolar tu JS:

// ... código anterior de encolado (el que arreglamos antes) ...

// Definir los datos que React necesita
$api_settings = [
    'root'  => esc_url_raw(rest_url()), // Devuelve 'http://tu-sitio.com/wp-json/'
    'nonce' => wp_create_nonce('wp_rest') // Token de seguridad OBLIGATORIO para POST
];

// Inyectar estos datos en el script principal
// Asegúrate de usar el mismo handle ('calculador-pecan-js') que usaste en wp_enqueue_script
wp_localize_script('calculador-pecan-js', 'pecanSettings', $api_settings);

// Si estás en modo desarrollo (Vite), también inyéctalo en el script de desarrollo
if (!file_exists($manifest_path)) {
    wp_localize_script('calculador-pecan-main', 'pecanSettings', $api_settings);
}


Paso 2: Registrar el Endpoint en PHP
Asegúrate de que en tu plugin tengas registrado el endpoint que reciba el POST. Debería verse algo así:


add_action('rest_api_init', function () {
    register_rest_route('ccp/v1', '/projects', [
        'methods' => 'POST',
        'callback' => 'crear_proyecto_pecan', // Tu función PHP que guarda en la BD
        'permission_callback' => function () {
            return is_user_logged_in(); // Solo usuarios logueados
        }
    ]);
});

function crear_proyecto_pecan($request) {
    $params = $request->get_json_params();
    
    // Aquí tu lógica para guardar en la base de datos (wp_insert_post o tabla custom)
    // Ejemplo:
    // global $wpdb;
    // ...
    
    return new WP_REST_Response(['message' => 'Proyecto creado', 'id' => 123], 200);
}


Importante: Después de agregar este código, ve a Ajustes > Enlaces permanentes en tu admin de WordPress y haz clic en "Guardar cambios" para refrescar las rutas de la API.

Paso 3: Consumir la API en React (Corregido)
Ahora en tu código React, cuando haces el fetch o axios, usa la variable global pecanSettings que creamos en el Paso 1.

Como estás usando TypeScript, primero declara la variable global para que no marque error:


// En tu archivo de servicio o donde haces la llamada (ej: api.ts)

// Declaramos que existe esta variable global inyectada por WordPress
declare global {
  interface Window {
    pecanSettings: {
      root: string;
      nonce: string;
    };
  }
}

export const createProject = async (projectData: any) => {
  // Construimos la URL correcta automáticamente
  // window.pecanSettings.root ya trae '.../wp-json/'
  const url = `${window.pecanSettings.root}ccp/v1/projects`;

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        // ESTO ES CRÍTICO: El Nonce de seguridad
        'X-WP-Nonce': window.pecanSettings.nonce,
      },
      body: JSON.stringify(projectData),
    });

    if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.message || 'Error en la petición');
    }

    return await response.json();
  } catch (error) {
    console.error("Error creating project:", error);
    throw error;
  }
};


El error 404 (Not Found) indica que tu aplicación React está intentando enviar los datos a una dirección que no existe.

Si te fijas en la URL del error: http://testcappecan.com/calculador-pecan/ccp/v1/projects

Le falta una parte clave de WordPress. La API REST de WordPress siempre vive bajo el prefijo /wp-json/. La URL correcta debería parecerse a: http://testcappecan.com/wp-json/ccp/v1/projects

Aquí tienes los 3 pasos para conectar React con WordPress correctamente, usando las mejores prácticas (seguridad y URLs dinámicas).

Paso 1: Pasar la URL de la API desde PHP a React
No escribas la URL "a mano" en React (hardcode), porque si cambias el dominio o mueves el sitio, se romperá. Usa wp_localize_script en tu archivo PHP principal para pasarle las variables a React.

En tu archivo PHP principal (donde haces el wp_enqueue_script), agrega esto justo después de encolar tu JS:

PHP

// ... código anterior de encolado (el que arreglamos antes) ...

// Definir los datos que React necesita
$api_settings = [
    'root'  => esc_url_raw(rest_url()), // Devuelve 'http://tu-sitio.com/wp-json/'
    'nonce' => wp_create_nonce('wp_rest') // Token de seguridad OBLIGATORIO para POST
];

// Inyectar estos datos en el script principal
// Asegúrate de usar el mismo handle ('calculador-pecan-js') que usaste en wp_enqueue_script
wp_localize_script('calculador-pecan-js', 'pecanSettings', $api_settings);

// Si estás en modo desarrollo (Vite), también inyéctalo en el script de desarrollo
if (!file_exists($manifest_path)) {
    wp_localize_script('calculador-pecan-main', 'pecanSettings', $api_settings);
}
Paso 2: Registrar el Endpoint en PHP
Asegúrate de que en tu plugin tengas registrado el endpoint que reciba el POST. Debería verse algo así:

PHP

add_action('rest_api_init', function () {
    register_rest_route('ccp/v1', '/projects', [
        'methods' => 'POST',
        'callback' => 'crear_proyecto_pecan', // Tu función PHP que guarda en la BD
        'permission_callback' => function () {
            return is_user_logged_in(); // Solo usuarios logueados
        }
    ]);
});

function crear_proyecto_pecan($request) {
    $params = $request->get_json_params();
    
    // Aquí tu lógica para guardar en la base de datos (wp_insert_post o tabla custom)
    // Ejemplo:
    // global $wpdb;
    // ...
    
    return new WP_REST_Response(['message' => 'Proyecto creado', 'id' => 123], 200);
}
Importante: Después de agregar este código, ve a Ajustes > Enlaces permanentes en tu admin de WordPress y haz clic en "Guardar cambios" para refrescar las rutas de la API.

Paso 3: Consumir la API en React (Corregido)
Ahora en tu código React, cuando haces el fetch o axios, usa la variable global pecanSettings que creamos en el Paso 1.

Como estás usando TypeScript, primero declara la variable global para que no marque error:

TypeScript

// En tu archivo de servicio o donde haces la llamada (ej: api.ts)

// Declaramos que existe esta variable global inyectada por WordPress
declare global {
  interface Window {
    pecanSettings: {
      root: string;
      nonce: string;
    };
  }
}

export const createProject = async (projectData: any) => {
  // Construimos la URL correcta automáticamente
  // window.pecanSettings.root ya trae '.../wp-json/'
  const url = `${window.pecanSettings.root}ccp/v1/projects`;

  try {
    const response = await fetch(url, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        // ESTO ES CRÍTICO: El Nonce de seguridad
        'X-WP-Nonce': window.pecanSettings.nonce,
      },
      body: JSON.stringify(projectData),
    });

    if (!response.ok) {
        const errorData = await response.json();
        throw new Error(errorData.message || 'Error en la petición');
    }

    return await response.json();
  } catch (error) {
    console.error("Error creating project:", error);
    throw error;
  }
};
Resumen de la solución
El error: Estabas llamando a /calculador-pecan/... en lugar de /wp-json/ccp/....

PHP: Usamos wp_localize_script para decirle a React dónde está la API (root) y darle permiso (nonce).

React: Usamos window.pecanSettings.root para armar la URL dinámicamente.

Implementa el Paso 1 y Paso 3 y prueba enviar el formulario de nuevo.




Error
Fatal error: Uncaught Error: Undefined constant "CALCULADORA_PECAN_PLUGIN_DIR" in C:\Users\cvict\Local Sites\testcappecan\app\public\wp-content\plugins\calculador-pecan\includes\api\class-ccp-api-manager.php:22 Stack trace: #0 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-content\plugins\calculador-pecan\calculador-pecan.php(68): CCP_API_Manager->register_rest_routes() #1 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\class-wp-hook.php(324): calculador_pecan_register_rest_routes(Object(WP_REST_Server)) #2 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\class-wp-hook.php(348): WP_Hook->apply_filters(NULL, Array) #3 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\plugin.php(517): WP_Hook->do_action(Array) #4 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\rest-api.php(628): do_action('rest_api_init', Object(WP_REST_Server)) #5 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\rest-api.php(452): rest_get_server() #6 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\class-wp-hook.php(324): rest_api_loaded(Object(WP)) #7 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\class-wp-hook.php(348): WP_Hook->apply_filters('', Array) #8 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\plugin.php(565): WP_Hook->do_action(Array) #9 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\class-wp.php(418): do_action_ref_array('parse_request', Array) #10 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\class-wp.php(818): WP->parse_request('') #11 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-includes\functions.php(1342): WP->main('') #12 C:\Users\cvict\Local Sites\testcappecan\app\public\wp-blog-header.php(16): wp() #13 C:\Users\cvict\Local Sites\testcappecan\app\public\index.php(17): require('C:\\Users\\cvict\\...') #14 {main} thrown in C:\Users\cvict\Local Sites\testcappecan\app\public\wp-content\plugins\calculador-pecan\includes\api\class-ccp-api-manager.php on line 22
Ha habido un error crítico en esta web.